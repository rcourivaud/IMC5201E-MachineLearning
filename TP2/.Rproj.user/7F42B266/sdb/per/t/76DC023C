{
    "contents" : "---\ntitle: \"TP1\"\nauthor: \"COURIVAUD - KOUEK\"\ndate: \"24 novembre 2016\"\noutput: pdf_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n## Data preparation\n\n```{r }\nFluTrain <- read.csv(\"FluTrain.csv\", header=FALSE)\ncolnames(FluTrain) = c(\"Weeks\", \"ILI\", \"Queries\")\n```\n\n```{r message = FALSE}\nlibrary(tidyr)\nlibrary(hydroGOF)\n```\n\n## Data Date Formating\n```{r }\nFluTrain = separate(data = FluTrain, col = Weeks, into = c(\"date1\", \"date2\"), sep = \" - \" )\nFluTrain$date1 = strptime(FluTrain$date1,format=\"%Y-%m-%d\")\nFluTrain$date2 = strptime(FluTrain$date2,format=\"%Y-%m-%d\")\nFluTrain$year = FluTrain$date1$year + 1900\nFluTrain$week = as.numeric( format(FluTrain$date1+3, \"%U\"))\nFluTrain$day = FluTrain$date1$nday\nFluTrain$month = FluTrain$date1$mon+1\n```\n### Nombre de cas par an\n\n\n```{r }\nplot(FluTrain$ILI,FluTrain$Queries)\n```\n\n\n### Cycle of Illness over years \n```{r }\nplot(FluTrain$ILI/mean(FluTrain$ILI), col=\"blue\")\nlines(FluTrain$Queries/mean(FluTrain$Queries), col=\"red\")\n```\n\n\n# 2\n## 2.1.1\n\nThe FluTrain dataset period is in 2004-2011.\n\n### Question 1)\n```{r }\nFluTrain[FluTrain$ILI==max(FluTrain$ILI),]\n\npaste(\"The week is \",FluTrain[FluTrain$ILI==max(FluTrain$ILI),]$week)\npaste(\"The day is \",FluTrain[FluTrain$ILI==max(FluTrain$ILI),]$date1$mday)\npaste(\"The month is \",FluTrain[FluTrain$ILI==max(FluTrain$ILI),]$date1$mon+1)\n```\n\n### Question 2)\n```{r }\nFluTrain[FluTrain$Queries==max(FluTrain$Queries),]\n\npaste(\"The week is \",FluTrain[FluTrain$Queries==max(FluTrain$Queries),]$week)\npaste(\"The day is \",FluTrain[FluTrain$Queries==max(FluTrain$Queries),]$date1$mday)\npaste(\"The month is \",FluTrain[FluTrain$Queries==max(FluTrain$Queries),]$date1$mon+1)\n```\n\n### 2.1.2\n```{r }\nhistoILI = hist(FluTrain$ILI)\n```\n\nMost of the ILI values are small, with a relatively small number of much larger values (in statistics, this sort of data is called \"skew right\").\n\n### 2.2.3\n```{r }\nplot((log(FluTrain$ILI)~(FluTrain$Queries)))\n```\n\nThere is a positive, linear relationship between log(ILI) and Queries.\n\n### 2.2.4\nlog(ILI) = β 0 + β 1 × Queries, where the slope β 1 is positive.\n\n### 2.2.5\n```{r }\nFluTrend1 = lm(log(ILI) ~ Queries, data=FluTrain)\nsummary(FluTrend1)\n\nmseTrend1.1 = sum(FluTrend1$residuals**2)/length(FluTrend1$residuals)\nmseTrend1.2 = sum(((predict(FluTrend1, FluTrain)-log(FluTrain$ILI))**2))/length(FluTrain$ILI)\n\nRsquared1 = summary(FluTrend1)$r.squared\nRsquared1\n\n#Manual calculation of Rsquarred\nRSS.Trend1 <- sum(FluTrend1$residuals**2)\nmodel0 = lm(log(ILI) ~ 1, data=FluTrain)\nTSS <- sum(model0$residuals**2)\nRsquared.calc =  1-(RSS.Trend1 /TSS)\nRsquared.calc\n```\n\n## 2.3\n```{r }\nFluTest <- read.csv(\"FluTest.csv\", header=FALSE)\n\ncolnames(FluTest) = c(\"Weeks\", \"ILI\", \"Queries\")\n\nhead(FluTest)\n```\n### 2.3.6\n```{r }\npaste(\"Predicted value for 11th March 2012 : \" ,exp(predict(FluTrend1, FluTest[FluTest$Weeks==\"2012-03-11 - 2012-03-17\",])))\n```\n### 2.3.7\n```{r }\npaste(\"The real value for 11th March 2012 : \" ,FluTest[FluTest$Weeks==\"2012-03-11 - 2012-03-17\",]$ILI)\npaste(\"Squared error : \" ,(exp(predict(FluTrend1, FluTest[FluTest$Weeks==\"2012-03-11 - 2012-03-17\",]))-FluTest[FluTest$Weeks==\"2012-03-11 - 2012-03-17\",]$ILI)**2)\n\n```\n### 2.3.8\n```{r }\nsum(((exp(predict(FluTrend1, FluTest))-FluTest$ILI)**2))/length(FluTest$ILI)\n```\n\n## 2.4\n### 2.4.9\n```{r }\nhead(FluTrain)\nFluTrain$ILI_Lag2 = c(c(NA, NA), as.vector(FluTrain$ILI[0:415]))\nplot(log(FluTrain$ILI_Lag2)~FluTrain$ILI)\n```\n\nThere is a strong positive relationship between log(ILI Lag2) and log(ILI).\n\n### 2.4.10\n```{r }\nFluTrend2 = lm(log(ILI) ~ Queries + log(ILI_Lag2) , data = FluTrain)\nsummary(FluTrend2)\n\nsummary(FluTrend2)$r.squared\nmseTrend2 = mean((predict(FluTrend2, FluTrain)-FluTrain$ILI)**2, na.rm=TRUE)\nRsquared2 = summary(FluTrend2)$r.squared\n```\n### 2.4.11\n```{r }\n\nmseTrend2<mseTrend1.1\nRsquared2>Rsquared1\n```\nDue to overfitting, FluTrend2 is a weaker model then FluTrend1 on the training set.\n\n## 2.5\n\n### 2.5.12\n\nThe ILI value of the second-to-last observation in the training data.\n\n### 2.5.13\nThe ILI value of the last observation in the training data.\n\n### 2.5.14\n\n```{r }\nFluTest$ILI_Lag2 = c( as.vector(FluTrain$ILI[416:417]), as.vector(FluTest$ILI[0:50]))\nas.vector(FluTrain$ILI[416:417])\n```\n\n### 2.5.15\n```{r }\ntest_predTrend2 = exp(predict(FluTrend2, FluTest))\nmse.test2 = mean((test_predTrend2-FluTest$ILI)**2, na.rm=TRUE)\n```\n### 2.5.16\n```{r }\ntest_predTrend1 = exp(predict(FluTrend1, FluTest))\nmse.test1 = mean((test_predTrend1-FluTest$ILI)**2, na.rm=TRUE)\nmse.test2<mse.test1\n```\n## 2.6\n```{r }\narima(FluTest$ILI, order = c(3,0,0), method = \"CSS\")\n```\n\n\n",
    "created" : 1481874059377.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2289482008",
    "id" : "76DC023C",
    "lastKnownWriteTime" : 1479980936,
    "path" : "U:/Cours/IMC-5101B/TP1/Tp1_rendu.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}